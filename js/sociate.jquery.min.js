var Sociate=Sociate||function(a,b){function c(a){return"string"==typeof a&&("http://localhost:8888/smallbusiness"===a.substring(0,35)?a="http://smallbusiness.com"+a.substring(35):"http://dev.smallbusiness.com"===a.substring(0,28)&&(a="http://smallbusiness.com"+a.substring(28))),a}this.url=c(a),this.postid=b,this.internalEndpoint=Sociate_Ajax.ajaxUrl,this.getSharedcount=function(a,b){if("string"==typeof a)var d=a;else var d=this.url;d=encodeURIComponent(c(d)||location.href);var e={url:"//"+("https:"==location.protocol?"sharedcount.appspot":"api.sharedcount")+".com/?url="+d,cache:!0,dataType:"json"};if("withCredentials"in new XMLHttpRequest)e.success=b;else{var f="sc_"+d.replace(/\W/g,"");window[f]=b,e.jsonpCallback=f,e.dataType+="p"}return $.ajax(e)},this.extractAllData=function(a){return{twitter:a.Twitter,facebook:a.Facebook.total_count||0,pinterest:a.Pinterest,"google-plus":a.GooglePlusOne,linkedin:a.LinkedIn}},this.extractSiteData=function(a,b){return a&&b?"facebook"===a?b.Facebook.total_count:"pinterest"===a?b.Pinterest:"linkedin"===a?b.LinkedIn:"google-plus"===a?b.GooglePlusOne:"twitter"===a?b.Twitter:!1:!1},this.getSiteCount=function(b){return"facebook"===b?$.ajax({url:"http://graph.facebook.com/?id="+a,dataType:"jsonp"}):"twitter"===b?$.ajax({url:"http://cdn.api.twitter.com/1/urls/count.json?url="+a,dataType:"jsonp"}):"linkedin"===b?$.ajax({url:"http://www.linkedin.com/countserv/count/share?url="+a,dataType:"jsonp"}):"pinterest"===b?$.ajax({url:"http://api.pinterest.com/v1/urls/count.json?url="+a,dataType:"jsonp"}):!1},this.getInternalData=function(){return $.ajax({url:this.internalEndpoint,dataType:"json",method:"POST",data:{postid:this.postid,action:"get_social"}})},this.updateInternalData=function(a,b){var c=$.extend(a,{action:"update_social",postid:this.postid});return"undefined"!=typeof b&&(c.postid=b),$.ajax({url:this.internalEndpoint,dataType:"json",method:"POST",action:"update_social",data:c})},this.updateAllPosts=function(){var a=this;$.ajax({url:this.internalEndpoint,data:{action:"get_all_posts"},method:"POST"}).done(function(b){function c(a){function b(){e.timeElapsed=((new Date).getTime()-d)/1e3,callback(e)}return a=a||1,function(){--a||b()}}var b=JSON.parse(b),d=(new Date).getTime(),e={updated:0,errors:0,timeElapsed:0},f=c(b.length),g=new CustomEvent("sociatePostUpdated",{detail:e});b.forEach(function(b){a.getSharedcount(b.posturl).done(function(c){a.updateInternalData(a.extractAllData(c),b.postid).done(function(){e.updated++}).always(function(){document.dispatchEvent(g),f()}).fail(function(){reponse.errors++})})})})}},SociateButtons=SociateButtons||function(a,b,c,d){Sociate.apply(this,Array.prototype.slice.call(arguments)),$.extend(this,{selector:".sociate-button",url:c.data("url"),title:c.data("title"),postid:c.data("postid"),summary:c.data("summary"),twitterAccount:c.data("twitteraccount"),targetBlank:!0,internalEndpoint:Sociate_Ajax.ajaxUrl,insertCounts:!1,updateInterval:15}),this.$buttons=$(this.selector),this.$post=$("#post-"+this.postid),this.imageUrl=function(){return c.data("imageurl")?c.data("imageurl"):$post.find('[class^="wp-image"]').first().attr("href")},$.extend(this,d),this.insertSocialCounts=function(a,b,c){b&&$buttons.each(function(){$(this).append('<i class="icon-spinner icon-spin"></i>')});var d=function(a){$buttons.each(function(){var c=$(this).data("site"),d=a[c];b&&$(this).find(".icon-spinner").remove(),"0"!==d&&($(this).find(".sociate-count").remove(),$(this).append('<span class="sociate-count">'+d+"</span>"))})};a?(d(a),c&&c(a)):this.getInternalData().done(function(a){d(this.extractAllData(a)),c&&c(a)})},this.checkSocialCount=function(){var a=this;this.getInternalData().done(function(b){(new Date).getTime()/6e4-b.updated/60>a.updateInterval&&a.getSharedcount().done(function(b){a.updateInternalData(a.extractAllData(b))})})},this.generateShareUrl=function(a){if("facebook"===a)return"http://www.facebook.com/sharer/sharer.php?u="+this.url;if("pinterest"===a){var b="http://pinterest.com/pin/create/button/?url="+this.url;return"string"==typeof this.summary&&(b+="&description="+this.summary),"string"==typeof this.imageUrl&&(b+="&media="+this.imageUrl),b}if("linkedin"===a){var b="http://www.linkedin.com/shareArticle?mini=true&url="+this.url+"&source="+this.url;return"string"==typeof this.title&&(b+="&title="+this.title),"string"==typeof this.summary&&(b+="&summary="+this.summary),b}if("google-plus"===a)return"http://plus.google.com/share?url="+this.url;if("twitter"===a){var b="https://twitter.com/intent/tweet?url="+this.url;return"string"==typeof this.title&&(b+="&text="+this.title),"string"==typeof this.twitterAccount&&(b+="&via="+this.twitterAccount),b}};var e=function(){this.targetBlank&&this.$buttons.each(function(){$(this).attr("target","_blank")}),"undefined"!=typeof this.url&&("http://localhost:8888/smallbusiness"===this.url.substring(0,35)?this.url="http://smallbusiness.com"+this.url.substring(35):"http://dev.smallbusiness.com"===this.url.substring(0,28)&&(this.url="http://smallbusiness.com"+this.url.substring(28))),this.$buttons.each(function(a,b){var c=$(b).data("site"),d=this.generateShareUrl(c);$(b).attr("href",d)}.bind(this)),this.checkSocialCount(),this.insertCounts&&this.insertSocialCounts(data),this.$buttons.attr("data-initialized","true")}.bind(this);e()};SociateButtons.prototype=new Sociate,document.addEventListener("sociateButtons",function(){$('.sociate-buttons[data-initialized="false"]').each(function(){new SociateButtons($(this).data("url"),$(this).data("postid"),$(this))})});